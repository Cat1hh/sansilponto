<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Ponto - Sansil</title>
    
    <style>
        :root {
            --primary-red: #E30613; 
            --dark-bg: #1a1a1a;
            --light-bg: #f4f4f4;
            --white: #ffffff;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--dark-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: var(--white);
        }

        .container {
            background: var(--white);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: 95%;
            max-width: 400px;
            color: #333;
            text-align: center;
        }

        h2 {
            color: var(--primary-red);
            text-transform: uppercase;
            font-weight: 900;
            border-bottom: 3px solid var(--primary-red);
            padding-bottom: 10px;
            margin-bottom: 25px;
        }

        .btn-primary {
            background-color: var(--primary-red);
            color: var(--white);
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            width: 100%;
            cursor: pointer;
            text-transform: uppercase;
            transition: 0.2s;
        }

        .btn-primary:hover { background-color: #b3050f; transform: scale(1.02); }

        .btn-outline {
            background: transparent;
            color: var(--primary-red);
            border: 2px solid var(--primary-red);
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            width: 100%;
            margin-top: 15px;
            cursor: pointer;
        }

        select, input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        /* Dashboard & Sidebar */
        .dashboard-container {
            display: flex;
            width: 100vw;
            height: 100vh;
            background: #f8f9fa;
            position: fixed;
            top: 0; left: 0;
        }

        .sidebar {
            width: 250px;
            background: #1a1a1a;
            color: white;
            display: flex;
            flex-direction: column;
            padding: 20px 0;
            transition: 0.3s;
        }

        .nav-links { list-style: none; padding: 0; flex-grow: 1; }
        .nav-links li {
            padding: 15px 25px;
            cursor: pointer;
            transition: 0.3s;
            border-left: 4px solid transparent;
            text-align: left;
        }
        .nav-links li:hover, .nav-links li.active {
            background: #333;
            border-left-color: var(--primary-red);
        }

        .admin-content { flex-grow: 1; padding: 30px; overflow-y: auto; color: #333; }

        .table-container { width: 100%; overflow-x: auto; margin-top: 20px; background: white; border-radius: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th { background-color: var(--primary-red); color: white; padding: 12px; font-size: 12px; }
        td { padding: 12px; border-bottom: 1px solid #ddd; text-align: center; font-size: 13px; }

        .grid-nomes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .card-funcionario-admin {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid var(--primary-red);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
        }

        .hamburger-btn {
            background: transparent; border: none; cursor: pointer;
            display: flex; flex-direction: column; gap: 5px; padding: 10px;
        }
        .hamburger-btn span { display: block; width: 25px; height: 3px; background: white; transition: 0.3s; }
        
        .hidden { display: none !important; }

        .dias-check {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin: 15px 0;
            text-align: left;
        }

        /* Estilo para quando estiver editando */
        .modo-edicao-ativo {
            border: 2px solid #ffc107 !important;
            background: #fffbef !important;
        }

        @media (max-width: 768px) {
            .sidebar { position: fixed; left: -250px; height: 100%; z-index: 1000; }
            .sidebar.active { left: 0; }
        }
    </style>
</head>
<body>

<div class="container" id="tela-perfil">
    <div class="logo-container">
        <img src="logosansil.png" alt="Sansil Padaria" style="width: 150px; margin-bottom: 10px;">
    </div>
    <button class="btn-primary" onclick="irPara('tela-ponto')" style="height: 80px;">üë§ REGISTRAR PONTO (SENHA)</button>
    <button class="btn-outline" onclick="checarAdmin()">üîë √ÅREA DA DONA (RESTRITO)</button>
</div>

<div class="container hidden" id="tela-ponto">
    <h2>ü•ñ Ponto por Senha</h2>
    <select id="select-func"></select>
    <input type="password" id="senha-ponto" maxlength="4" inputmode="numeric" placeholder="Sua Senha PIN">
    <select id="tipo-ponto">
        <option value="Entrada (05:45)">Entrada (05:45)</option>
        <option value="Sa√≠da p/ Almo√ßo">Sa√≠da p/ Almo√ßo</option>
        <option value="Retorno Almo√ßo">Retorno Almo√ßo</option>
        <option value="Sa√≠da p/ Caf√©">Sa√≠da p/ Caf√©</option>
        <option value="Retorno Caf√©">Retorno Caf√©</option>
        <option value="Sa√≠da (Fim do Expediente)">Sa√≠da Final</option>
    </select>
    <button id="btn-bater-ponto" class="btn-primary" onclick="confirmarPontoSenha()" style="background-color: #28a745;">CONFIRMAR</button>
    <button class="btn-outline" style="border-color:#ccc; color:#666;" onclick="irPara('tela-perfil')">VOLTAR</button>
</div>

<div id="tela-admin" class="hidden dashboard-container">
    <nav class="sidebar" id="sidebar">
        <div style="padding: 20px; text-align: center;"><img src="logosansil.png" style="width: 80px;"></div>
        <ul class="nav-links">
            <li class="active" onclick="mudarAbaAdmin('aba-relatorio')">üìä Relat√≥rios</li>
            <li onclick="mudarAbaAdmin('aba-funcionarios')">üë• Funcion√°rios</li>
        </ul>
        <button class="btn-outline" style="margin:20px; border-color:#ff4444; color:#ff4444;" onclick="irPara('tela-perfil')">Sair</button>
    </nav>

    <main class="admin-content">
        <header style="display: flex; align-items: center; gap: 15px;">
            <button class="hamburger-btn" onclick="toggleSidebar()"><span></span><span></span><span></span></button>
            <h2 style="margin:0; border:none;">Painel Administrativo</h2>
        </header>

        <section id="aba-relatorio" class="admin-section">
            <div id="container-lista-funcionarios">
                <div id="lista-nomes-resumo" class="grid-nomes"></div>
            </div>
            <div id="container-detalhes-ponto" class="hidden">
                <button class="btn-outline" onclick="voltarParaLista()" style="width:auto; margin-bottom:15px;">‚¨Ö Voltar</button>
                <h3 id="nome-funcionario-selecionado"></h3>
                <div class="table-container">
                    <table id="tabela-pontos-admin">
                        <thead>
                            <tr><th>Data</th><th>E</th><th>S.A</th><th>R.A</th><th>S.C</th><th>R.C</th><th>S</th></tr>
                        </thead>
                        <tbody id="tabela-corpo"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="aba-funcionarios" class="admin-section hidden">
            <div class="form-container" id="form-func" style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: left;">
                <h3 id="titulo-form-func">‚ûï Novo Funcion√°rio</h3>
                
                <label>Nome:</label>
                <input type="text" id="novo-nome">
                
                <label>Senha PIN (4 d√≠gitos):</label>
                <input type="password" id="novo-senha" maxlength="4">
                
                <label>ID Biometria:</label>
                <input type="number" id="id-biometria">
                
                <label>Dias de Trabalho:</label>
                <div class="dias-check">
                    <label><input type="checkbox" class="dia-semana" value="Seg"> Seg</label>
                    <label><input type="checkbox" class="dia-semana" value="Ter"> Ter</label>
                    <label><input type="checkbox" class="dia-semana" value="Qua"> Qua</label>
                    <label><input type="checkbox" class="dia-semana" value="Qui"> Qui</label>
                    <label><input type="checkbox" class="dia-semana" value="Sex"> Sex</label>
                    <label><input type="checkbox" class="dia-semana" value="Sab"> Sab</label>
                    <label><input type="checkbox" class="dia-semana" value="Dom"> Dom</label>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button class="btn-primary" id="btn-salvar-func" onclick="cadastrarFuncionario()">SALVAR</button>
                    <button class="btn-outline hidden" id="btn-cancelar-edit" style="margin:0; border-color:#666; color:#666;" onclick="cancelarEdicao()">CANCELAR</button>
                </div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr><th>Nome</th><th>ID</th><th>A√ß√µes</th></tr>
                    </thead>
                    <tbody id="tabela-equipe-corpo"></tbody>
                </table>
            </div>
        </section>
    </main>
</div>

<script>
    let editandoModo = false;
    let idEdicao = null;
    let todosOsPontos = [];

    function irPara(idTela) {
        document.querySelectorAll('body > div, .admin-section').forEach(d => { if(d.id) d.classList.add('hidden'); });
        document.getElementById(idTela).classList.remove('hidden');
        if(idTela === 'tela-admin') document.getElementById('aba-relatorio').classList.remove('hidden');
    }

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }

    // --- FUN√á√ÉO EDITAR ---
    function prepararEdicao(id, nome, senha, idBio, dias) {
        editandoModo = true;
        idEdicao = id;

        // 1. Muda o visual do formul√°rio
        document.getElementById('titulo-form-func').innerText = "‚úèÔ∏è Editando: " + nome;
        document.getElementById('form-func').classList.add('modo-edicao-ativo');
        document.getElementById('btn-salvar-func').innerText = "ATUALIZAR DADOS";
        document.getElementById('btn-cancelar-edit').classList.remove('hidden');

        // 2. Preenche os campos
        document.getElementById('novo-nome').value = nome;
        document.getElementById('novo-senha').value = senha;
        document.getElementById('id-biometria').value = idBio;

        // 3. Marca os dias da semana
        const listaDias = dias ? dias.split(', ') : [];
        document.querySelectorAll('.dia-semana').forEach(cb => {
            cb.checked = listaDias.includes(cb.value);
        });

        // Sobe a tela para o formul√°rio
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function cancelarEdicao() {
        editandoModo = false;
        idEdicao = null;
        document.getElementById('titulo-form-func').innerText = "‚ûï Novo Funcion√°rio";
        document.getElementById('form-func').classList.remove('modo-edicao-ativo');
        document.getElementById('btn-salvar-func').innerText = "SALVAR";
        document.getElementById('btn-cancelar-edit').classList.add('hidden');

        // Limpa campos
        document.getElementById('novo-nome').value = "";
        document.getElementById('novo-senha').value = "";
        document.getElementById('id-biometria').value = "";
        document.querySelectorAll('.dia-semana').forEach(cb => cb.checked = false);
    }

    async function cadastrarFuncionario() {
        const nome = document.getElementById('novo-nome').value;
        const senha = document.getElementById('novo-senha').value;
        const idBio = document.getElementById('id-biometria').value;
        const dias = Array.from(document.querySelectorAll('.dia-semana:checked')).map(cb => cb.value).join(', ');

        if(!nome || !senha) return alert("Nome e Senha s√£o obrigat√≥rios!");

        const payload = {
            id: idEdicao,
            nome,
            senha,
            id_biometria: idBio,
            diasTrabalho: dias,
            modoEdicao: editandoModo
        };

        try {
            const res = await fetch('/admin/cadastrar-funcionario', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload)
            });

            if(res.ok) {
                alert(editandoModo ? "Atualizado com sucesso!" : "Cadastrado com sucesso!");
                cancelarEdicao();
                listarEquipe();
                atualizarSelectPonto();
            }
        } catch (e) { alert("Erro ao salvar."); }
    }

    async function listarEquipe() {
        const res = await fetch('/admin/equipe');
        const equipe = await res.json();
        const corpo = document.getElementById('tabela-equipe-corpo');
        corpo.innerHTML = "";
        equipe.forEach(f => {
            // Passamos todos os dados para a fun√ß√£o prepararEdicao por par√¢metro
            corpo.innerHTML += `<tr>
                <td>${f.nome}</td>
                <td>${f.id_biometria || '-'}</td>
                <td><button class="btn-primary" style="font-size:10px; width:auto; padding:5px 10px; background:#ffc107; color:#000;" 
                    onclick="prepararEdicao(${f.id}, '${f.nome}', '${f.senha}', '${f.id_biometria}', '${f.dias_trabalho}')">EDITAR</button></td>
            </tr>`;
        });
    }

    // --- Outras fun√ß√µes mantidas do original ---
    async function carregarRelatorio() {
        const res = await fetch('/admin/pontos');
        const data = await res.json();
        todosOsPontos = data.pontos;
        renderizarListaFuncionarios();
    }

    function renderizarListaFuncionarios() {
        const container = document.getElementById('lista-nomes-resumo');
        container.innerHTML = "";
        const nomesUnicos = [...new Set(todosOsPontos.map(p => p.funcionario))];
        nomesUnicos.forEach(nome => {
            const card = document.createElement('div');
            card.className = "card-funcionario-admin";
            card.innerHTML = `<strong>${nome}</strong>`;
            card.onclick = () => verDetalhesFuncionario(nome);
            container.appendChild(card);
        });
    }

    function verDetalhesFuncionario(nome) {
        document.getElementById('container-lista-funcionarios').classList.add('hidden');
        document.getElementById('container-detalhes-ponto').classList.remove('hidden');
        document.getElementById('nome-funcionario-selecionado').innerText = nome;
        // L√≥gica de preenchimento da tabela de pontos aqui...
    }

    function voltarParaLista() {
        document.getElementById('container-lista-funcionarios').classList.remove('hidden');
        document.getElementById('container-detalhes-ponto').classList.add('hidden');
    }

    async function atualizarSelectPonto() {
        const res = await fetch('/admin/equipe');
        const equipe = await res.json();
        const select = document.getElementById('select-func');
        select.innerHTML = '<option value="">Selecione seu nome</option>';
        equipe.forEach(f => { select.innerHTML += `<option value="${f.nome}">${f.nome}</option>`; });
    }

    function mudarAbaAdmin(abaId) {
        document.querySelectorAll('.admin-section').forEach(s => s.classList.add('hidden'));
        document.getElementById(abaId).classList.remove('hidden');
        if(abaId === 'aba-funcionarios') listarEquipe();
        if(abaId === 'aba-relatorio') carregarRelatorio();
    }

    function checarAdmin() {
        const s = prompt("Senha:");
        if(s === "sansil2026") irPara('tela-admin');
    }

    window.onload = atualizarSelectPonto;
</script>
</body>
</html>
